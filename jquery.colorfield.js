// Generated by CoffeeScript 1.3.3
(function() {
  var $, activate_picker, apply_color, color_field_class, color_field_selector, color_value_selector, destroy_picker, is_initialized, update_color, valid_colors;

  $ = jQuery;

  is_initialized = false;

  color_field_class = 'color-field';

  color_field_selector = "." + color_field_class;

  color_value_selector = '.color-field-value';

  valid_colors = ['#7bd148', '#5484ed', '#a4bdfc', '#46d6db', '#7ae7bf', '#51b749', '#fbd75b', '#ffb878', '#ff887c', '#dc2127', '#dbadff', '#e1e1e1'];

  $.fn.extend({
    colorfield: function() {
      var is_initalized;
      if (!is_initalized) {
        $(color_field_selector).live('click', activate_picker);
        $(color_field_selector).live('blur', destroy_picker);
        $(color_field_selector).each(update_color);
        is_initalized = true;
      }
      return this.each(function() {
        var $this, data;
        $this = $(this);
        data = $this.data('color-field');
        if (data == null) {
          $this.data('color-field', true);
          $this.addClass(color_field_class, true);
          return update_color.call($this);
        }
      });
    }
  });

  activate_picker = function() {
    var $action_field, $container, $value_field, old_color;
    $(this).after('<div id="color-picker-container" style=""></div>');
    $container = $('#color-picker-container');
    $action_field = $(this);
    $value_field = $(this).siblings(color_value_selector);
    old_color = $value_field.val();
    $.each(valid_colors, function(i, color) {
      return $container.append("<div class='color-picker-choice' style='background-color: " + color + "'>&nbsp;</div>");
    });
    return $('.color-picker-choice').hover(function() {
      var new_color;
      new_color = $(this).css('background-color');
      $value_field.val(new_color);
      return update_color.call($action_field);
    }, function() {
      return apply_color.call($action_field, old_color);
    });
  };

  apply_color = function(color) {
    return $(this).css('background', color);
  };

  update_color = function() {
    return apply_color.call(this, $(this).siblings(color_value_selector).val());
  };

  destroy_picker = function() {
    return $('#color-picker-container').remove();
  };

}).call(this);
